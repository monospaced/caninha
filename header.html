<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <!--
  Caninha is based on Sugarcane 1.1, which is based on:

  TiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

  Published under a BSD open source license

  Copyright (c) Osmosoft Limited 2005

  Redistribution and use in source and binary forms, with or without modification,
  are permitted provided that the following conditions are met:

  Redistributions of source code must retain the above copyright notice, this
  list of conditions and the following disclaimer.

  Redistributions in binary form must reproduce the above copyright notice, this
  list of conditions and the following disclaimer in the documentation and/or other
  materials provided with the distribution.

  Neither the name of the Osmosoft Limited nor the names of its contributors may be
  used to endorse or promote products derived from this software without specific
  prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
  SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
  ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
  DAMAGE.
  -->
  <title>Caninha</title>
  <meta name="viewport" content="width=device-width">
  <style>
body{background-color:#000;color:#fff;font-family:Verdana,sans-serif;font-size:62.5%;margin:4em 15% 5% 5em}#sidebar{position:fixed;top:4.2em;left:7.5em;width:12em;list-style:none;margin:0;padding:0 1em 0 0;font:bold 1.1em Verdana,sans-serif}#sidebar li{color:#333;text-align:right;background-repeat:no-repeat;margin-bottom:1em}#sidebar li:hover{color:#fff;cursor:pointer}#sidebar li a{color:#333}#sidebar li a:hover{color:#fff;text-decoration:none}#sidebar #title{color:#999;font-size:150%;cursor:auto}#sidebar #title a{color:#999}#sidebar #title a:hover{color:#fff}#sidebar #storyAuthor{font-size:50%}#sidebar #storyMenu{display:none;line-height:2.5em;margin-bottom:0.5em}#sidebar #title:hover{color:#999}#sidebar #credits{padding-top:2em;font-weight:normal;font-size:80%;cursor:auto}#sidebar #credits:hover{color:#333}#sidebar #credits a{text-decoration:none}.menu{position:absolute;display:none;background-color:#343434;color:#fff;opacity:0.9;border:1px solid #fff;text-align:left;font:1.1em Verdana;line-height:2em}.menu div{padding:0 0.4em}.menu div:hover{cursor:pointer;background-color:#fff;color:#343434}#passages{margin-left:18.2em;border-left:1px solid #333;padding-left:1.5em}.passage{font-size:1.2em;line-height:175%;margin-bottom:2em;text-align:left}.passage ul{padding-top:1.3em;text-align:center}.passage li{display:inline;margin-right:6em}a.internalLink,a.externalLink,a.back{color:#4d6ad8;font-weight:bold;text-decoration:none}a.internalLink:hover,a.externalLink:hover,a.back:hover{color:#8ea6ff;text-decoration:underline}a.brokenLink{background-color:red;text-decoration:none;color:#000}.marked{background-color:red;color:#000;margin-right:12px;padding:3px}.passage ul{margin-left:0.5em;padding-left:1.5em}.passage ol{margin-left:0.5em;padding-left:1.5em}.passage table{border-collapse:collapse;font-size:100%;margin:0.8em 1.0em}.passage th,.passage td,.passage tr,.passage caption{padding:3px}.passage hr{height:1px}#storeArea{display:none}
  </style>
  <script>(function(){
function $(a){return"use strict",typeof a=="string"?document.getElementById(a):a}function clone(a){"use strict";var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function insertText(a,b){return"use strict",a.appendChild(document.createTextNode(b))}function insertElement(a,b,c,d,e){"use strict";var f=document.createElement(b);return c&&(f.id=c),d&&(f.className=d),e&&insertText(f,e),a&&a.appendChild(f),f}function removeChildren(a){"use strict";while(a.hasChildNodes())a.removeChild(a.firstChild)}function addStyle(a){"use strict";var b;document.createStyleSheet?document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style>"+a+"</style>"):(b=document.createElement("style"),b.type="text/css",b.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(b))}function Wikifier(a,b){"use strict",this.source=b,this.output=a,this.nextMatch=0,this.assembleFormatterMatches(Wikifier.formatters),this.subWikify(this.output)}function throwError(a,b){"use strict",new Wikifier(a,"'' @@ "+b+" @@ ''")}function fade(a,b){function g(){c+=.05*e,h(d,Math.easeInOut(c));if(e===1&&c>=1||e===-1&&c<=0)console.log("swapping fader proxy out"),a.style.visibility=b.fade==="in"?"visible":"hidden",d.parentNode.replaceChild(a,d),window.clearInterval(f),b.onComplete&&b.onComplete()}function h(a,b){var c=Math.floor(b*100);a.style.zoom=1,a.style.filter="alpha(opacity="+c+")",a.style.opacity=b}"use strict";var c,d=a.cloneNode(!0),e=b.fade==="in"?1:-1,f;a.parentNode.replaceChild(d,a),b.fade==="in"?(c=0,d.style.visibility="visible"):c=1,h(d,c),f=window.setInterval(g,25)}function scrollWindowTo(a){function h(){c+=.1,window.scrollTo(0,b+f*e*Math.easeInOut(c)),c>=1&&window.clearInterval(g)}function i(a){var b=j(a),c=b+a.offsetHeight,d=window.scrollY?window.scrollY:document.body.scrollTop,e=window.innerHeight?window.innerHeight:document.body.clientHeight,f=d+e;return b<d?b:c>f?a.offsetHeight<e?b-(e-a.offsetHeight)+20:b:b}function j(a){var b=0;while(a.offsetParent)b+=a.offsetTop,a=a.offsetParent;return b}"use strict";var b=window.scrollY?window.scrollY:document.body.scrollTop,c=0,d,e,f,g;d=i(a),e=Math.abs(b-d),f=b>d?-1:1,g=window.setInterval(h,25)}function History(){"use strict",this.history=[{passage:null,variables:{},hash:null}]}function Passage(a,b,c){"use strict",this.title=a,b?(this.id=c,this.initialText=this.text=Passage.unescapeLineBreaks(b.firstChild?b.firstChild.nodeValue:""),this.tags=b.getAttribute("tags"),typeof this.tags=="string"?this.tags=this.tags.readBracketedList():this.tags=[]):(this.initialText=this.text="@@This passage does not exist.@@",this.tags=[])}function Tale(){"use strict";var a,b,c;this.passages={},document.normalize&&document.normalize(),a=$("storeArea").childNodes;for(var d=0;d<a.length;d++)c=a[d],c.getAttribute&&(b=c.getAttribute("tiddler")),b&&(this.passages[b]=new Passage(b,c,d))}function setPageElement(a,b,c){"use strict";var d=$(a);d&&(removeChildren(d),tale.has(b)?new Wikifier(d,tale.get(b).text):new Wikifier(d,c))}function main(){"use strict";var styles,scripts;tale=new Tale,document.title=tale.title,setPageElement("storyTitle","StoryTitle","Untitled Story"),tale.has("StoryAuthor")&&($("titleSeparator").innerHTML="<br />",setPageElement("storyAuthor","StoryAuthor","")),tale.has("StoryMenu")&&($("storyMenu").style.display="block",setPageElement("storyMenu","StoryMenu",""));for(var macro in macros)typeof macro.init=="function"&&macro.init();styles=tale.lookup("tags","stylesheet");for(var i=0;i<styles.length;i++)addStyle(styles[i].text);scripts=tale.lookup("tags","script");for(var n=0;n<scripts.length;n++)try{eval(scripts[n].text)}catch(e){window.alert("There is a technical problem with this story ("+scripts[n].title+": "+e.message+"). You may be able "+"to continue reading, but all parts of the story may not "+"work properly.")}state=new History,state.init(),console.log("init complete",tale,state)}var version={major:2,minor:0,revision:0,date:new Date("July 30, 2007"),extensions:{}},tale,state,macros={};Math.easeInOut=function(a){return"use strict",1-(Math.cos(a*Math.PI)+1)/2},String.prototype.readMacroParams=function(){"use strict";var a=new RegExp("(?:\\s*)(?:(?:\"([^\"]*)\")|(?:'([^']*)')|(?:\\[\\[([^\\]]*)\\]\\])|([^\"'\\s]\\S*))","mg"),b=[],c;do c=a.exec(this),c&&(c[1]?b.push(c[1]):c[2]?b.push(c[2]):c[3]?b.push(c[3]):c[4]&&b.push(c[4]));while(c);return b},String.prototype.readBracketedList=function(){"use strict";var a="\\[\\[([^\\]]+)\\]\\]",b="[^\\s$]+",c="(?:"+a+")|("+b+")",d=new RegExp(c,"mg"),e=[],f;do f=d.exec(this),f&&(f[1]?e.push(f[1]):f[2]&&e.push(f[2]));while(f);return e},String.prototype.trim=function(){return"use strict",this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";var c=this.length;b=b?b:0;for(var d=b;d<c;d++)if(this[d]===a)return d;return-1}),Wikifier.prototype.assembleFormatterMatches=function(a){"use strict";var b=[];this.formatters=[];for(var c=0;c<a.length;c++)b.push("("+a[c].match+")"),this.formatters.push(a[c]);this.formatterRegExp=new RegExp(b.join("|"),"mg")},Wikifier.prototype.subWikify=function(a,b){"use strict";var c,d,e,f,g;c=this.output,this.output=a,d=b?new RegExp("("+b+")","mg"):null;do{this.formatterRegExp.lastIndex=this.nextMatch,d&&(d.lastIndex=this.nextMatch),e=this.formatterRegExp.exec(this.source),f=d?d.exec(this.source):null;if(f&&(!e||f.index<=e.index)){f.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,f.index),this.matchStart=f.index,this.matchLength=f[1].length,this.matchText=f[1],this.nextMatch=f.index+f[1].length,this.output=c;return}if(e){e.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,e.index),this.matchStart=e.index,this.matchLength=e[0].length,this.matchText=e[0],this.nextMatch=this.formatterRegExp.lastIndex,g=-1;for(var h=1;h<e.length;h++)e[h]&&(g=h-1);g!==-1&&this.formatters[g].handler(this)}}while(f||e);this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length),this.output=c},Wikifier.prototype.outputText=function(a,b,c){"use strict",insertText(a,this.source.substring(b,c))},Wikifier.prototype.fullArgs=function(){"use strict";var a=this.source.indexOf(" ",this.matchStart),b=this.source.indexOf(">>",this.matchStart);return Wikifier.parse(this.source.slice(a,b))},Wikifier.parse=function(a){"use strict";var b=a.replace(/\$/g,"state.history[0].variables.");return b=b.replace(/\beq\b/gi," == "),b=b.replace(/\bneq\b/gi," != "),b=b.replace(/\bgt\b/gi," > "),b=b.replace(/\beq\b/gi," == "),b=b.replace(/\bneq\b/gi," != "),b=b.replace(/\bgt\b/gi," > "),b=b.replace(/\bgte\b/gi," >= "),b=b.replace(/\blt\b/gi," < "),b=b.replace(/\blte\b/gi," <= "),b=b.replace(/\band\b/gi," && "),b=b.replace(/\bor\b/gi," || "),b=b.replace(/\bnot\b/gi," ! "),b},Wikifier.formatHelpers={charFormatHelper:function(a){"use strict";var b=insertElement(a.output,this.element);a.subWikify(b,this.terminator)},inlineCssHelper:function(a){"use strict";var b=[],c="(?:("+Wikifier.textPrimitives.anyLetter+"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:("+Wikifier.textPrimitives.anyLetter+"+):([^;\\|\\n]+);)",d=new RegExp(c,"mg"),e=!1,f,g;do{d.lastIndex=a.nextMatch,f=d.exec(a.source),g=f&&f.index===a.nextMatch;if(g){var h,i;e=!0,f[1]?(h=f[1].unDash(),i=f[2]):(h=f[3].unDash(),i=f[4]),h==="bgcolor"&&(h="backgroundColor"),b.push({style:h,value:i}),a.nextMatch=f.index+f[0].length}}while(g);return b},monospacedByLineHelper:function(a){"use strict";var b=new RegExp(this.lookahead,"mg"),c,d;b.lastIndex=a.matchStart,c=b.exec(a.source),c&&c.index===a.matchStart&&(d=c[1],navigator.userAgent.indexOf("msie")!==-1&&navigator.userAgent.indexOf("opera")===-1&&(d=d.replace(/\n/g,"\r")),insertElement(a.output,"pre",null,null,d),a.nextMatch=c.index+c[0].length)}},Wikifier.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhc]?)$",lookahead:"^\\|([^\\n]*)\\|([fhc]?)$",rowTerminator:"\\|(?:[fhc]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[fhc]?$\\n?)",cellTerminator:"(?:\\x20*)\\|",rowTypes:{c:"caption",h:"thead","":"tbody",f:"tfoot"},handler:function(a){"use strict";var b=insertElement(a.output,"table"),c=new RegExp(this.lookahead,"mg"),d=null,e,f,g,h=[],i=0,j,k;a.nextMatch=a.matchStart;do c.lastIndex=a.nextMatch,j=c.exec(a.source),k=j&&j.index===a.nextMatch,k&&(e=j[2],e!==d&&(f=insertElement(b,this.rowTypes[e])),d=e,d==="c"?(i===0?f.setAttribute("align","top"):f.setAttribute("align","bottom"),a.nextMatch=a.nextMatch+1,a.subWikify(f,this.rowTerminator)):(g=insertElement(f,"tr"),this.rowHandler(a,g,h)),i++);while(k)},rowHandler:function(a,b,c){"use strict";var d=0,e=1,f=new RegExp(this.cellPattern,"mg"),g,h,i,j,k,l,m,n,o;do{f.lastIndex=a.nextMatch,g=f.exec(a.source),h=g&&g.index===a.nextMatch;if(h){if(g[1]==="~")i=c[d],i&&(i.rowCount++,i.element.setAttribute("rowSpan",i.rowCount),i.element.setAttribute("rowspan",i.rowCount),i.element.valign="center"),a.nextMatch=g.index+g[0].length-1;else if(g[1]===">")e++,a.nextMatch=g.index+g[0].length-1;else{if(g[2]){a.nextMatch=g.index+g[0].length;break}j=!1,k=!1,a.nextMatch++,l=Wikifier.formatHelpers.inlineCssHelper(a);while(a.source.substr(a.nextMatch,1)===" ")j=!0,a.nextMatch++;a.source.substr(a.nextMatch,1)==="!"?(m=insertElement(b,"th"),a.nextMatch++):m=insertElement(b,"td"),c[d]={rowCount:1,element:m},n=1,o=m,e>1&&(m.setAttribute("colSpan",e),m.setAttribute("colspan",e),e=1);for(var p=0;p<l.length;p++)m.style[l[p].style]=l[p].value;a.subWikify(m,this.cellTerminator),a.matchText.substr(a.matchText.length-2,1)===" "&&(k=!0),j&&k?m.align="center":j?m.align="right":k&&(m.align="left"),a.nextMatch=a.nextMatch-1}d++}}while(h)}},{name:"rule",match:"^----$\\n?",handler:function(a){"use strict",insertElement(a.output,"hr")}},{name:"emdash",match:"--",handler:function(a){"use strict";var b=insertElement(a.output,"span");b.innerHTML="&mdash;"}},{name:"heading",match:"^!{1,5}",terminator:"\\n",handler:function(a){"use strict";var b=insertElement(a.output,"h"+a.matchLength);a.subWikify(b,this.terminator)}},{name:"monospacedByLine",match:"^\\{\\{\\{\\n",lookahead:"^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"monospacedByLineForPlugin",match:"^//\\{\\{\\{\\n",lookahead:"^//\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^//\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"wikifyCommentForPlugin",match:"^/\\*\\*\\*\\n",terminator:"^\\*\\*\\*/\\n",handler:function(a){"use strict",a.subWikify(a.output,this.terminator)}},{name:"quoteByBlock",match:"^<<<\\n",terminator:"^<<<\\n",handler:function(a){"use strict";var b=insertElement(a.output,"blockquote");a.subWikify(b,this.terminator)}},{name:"quoteByLine",match:"^>+",terminator:"\\n",element:"blockquote",handler:function(a){"use strict";var b=new RegExp(this.match,"mg"),c=[a.output],d=0,e=a.matchLength,f,g,h;do{if(e>d)for(f=d;f<e;f++)c.push(insertElement(c[c.length-1],this.element));else if(e<d)for(f=d;f>e;f--)c.pop();d=e,a.subWikify(c[c.length-1],this.terminator),insertElement(c[c.length-1],"br"),b.lastIndex=a.nextMatch,g=b.exec(a.source),h=g&&g.index===a.nextMatch,h&&(e=g[0].length,a.nextMatch+=g[0].length)}while(h)}},{name:"list",match:"^(?:(?:\\*+)|(?:#+))",lookahead:"^(?:(\\*+)|(#+))",terminator:"\\n",outerElement:"ul",itemElement:"li",handler:function(a){"use strict";var b=new RegExp(this.lookahead,"mg"),c=null,d=0,e,f,g,h,i,j,k;a.nextMatch=a.matchStart,h=[a.output];do{b.lastIndex=a.nextMatch,i=b.exec(a.source),j=i&&i.index===a.nextMatch;if(j){i[1]&&(e="ul"),i[2]&&(e="ol"),f=i[0].length,a.nextMatch+=i[0].length;if(f>d)for(g=d;g<f;g++)h.push(insertElement(h[h.length-1],e));else if(f<d)for(g=d;g>f;g--)h.pop();else f===d&&e!==c&&(h.pop(),h.push(insertElement(h[h.length-1],e)));d=f,c=e,k=insertElement(h[h.length-1],"li"),a.subWikify(k,this.terminator)}}while(j)}},{name:"prettyLink",match:"\\[\\[",lookahead:"\\[\\[([^\\|\\]]*?)(?:(\\]\\])|(\\|(.*?)\\]\\]))",terminator:"\\|",handler:function(a){"use strict";var b=new RegExp(this.lookahead,"mg"),c,d,e;b.lastIndex=a.matchStart,c=b.exec(a.source),c&&c.index===a.matchStart&&c[2]?(d=Wikifier.createInternalLink(a.output,c[1]),a.outputText(d,a.nextMatch,a.nextMatch+c[1].length),a.nextMatch+=c[1].length+2):c&&c.index===a.matchStart&&c[3]&&(tale.has(c[4])?e=Wikifier.createInternalLink(a.output,c[4]):e=Wikifier.createExternalLink(a.output,c[4]),a.outputText(e,a.nextMatch,a.nextMatch+c[1].length),a.nextMatch=c.index+c[0].length)}},{name:"urlLink",match:"(?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b)",handler:function(a){"use strict";var b=Wikifier.createExternalLink(a.output,a.matchText);a.outputText(b,a.matchStart,a.nextMatch)}},{name:"image",match:"\\[(?:[<]{0,1})(?:[>]{0,1})[Ii][Mm][Gg]\\[",lookahead:"\\[([<]{0,1})([>]{0,1})[Ii][Mm][Gg]\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\]?)?(\\])",handler:function(a){"use strict";var b=new RegExp(this.lookahead,"mg"),c,d,e;b.lastIndex=a.matchStart,c=b.exec(a.source),c&&c.index===a.matchStart&&(d=a.output,c[5]&&(tale.has(c[5])?d=Wikifier.createInternalLink(a.output,c[5]):d=Wikifier.createExternalLink(a.output,c[5])),e=insertElement(d,"img"),c[1]?e.align="left":c[2]&&(e.align="right"),c[3]&&(e.title=c[3]),e.src=c[4],a.nextMatch=c.index+c[0].length)}},{name:"macro",match:"<<",lookahead:"<<([^>\\s]+)(?:\\s*)([^>]*)>>",handler:function(a){"use strict";var b=new RegExp(this.lookahead,"mg"),c,d,e;b.lastIndex=a.matchStart,c=b.exec(a.source);if(c&&c.index===a.matchStart&&c[1]){d=c[2].readMacroParams(),a.nextMatch=c.index+c[0].length;try{e=macros[c[1]],e&&e.handler?e.handler(a.output,c[1],d,a):insertElement(a.output,"span",null,"marked","macro not found: "+c[1])}catch(f){throwError(a.output,"Error executing macro "+c[1]+": "+f.toString())}}}},{name:"html",match:"<[Hh][Tt][Mm][Ll]>",lookahead:"<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)</[Hh][Tt][Mm][Ll]>",handler:function(a){"use strict";var b=new RegExp(this.lookahead,"mg"),c,d;b.lastIndex=a.matchStart,c=b.exec(a.source),c&&c.index===a.matchStart&&(d=insertElement(a.output,"span"),d.innerHTML=c[1],a.nextMatch=c.index+c[0].length)}},{name:"commentByBlock",match:"/%",lookahead:"/%((?:.|\\n)*?)%/",handler:function(a){"use strict";var b=new RegExp(this.lookahead,"mg"),c;b.lastIndex=a.matchStart,c=b.exec(a.source),c&&c.index===a.matchStart&&(a.nextMatch=c.index+c[0].length)}},{name:"boldByChar",match:"''",terminator:"''",element:"strong",handler:Wikifier.formatHelpers.charFormatHelper},{name:"strikeByChar",match:"==",terminator:"==",element:"strike",handler:Wikifier.formatHelpers.charFormatHelper},{name:"underlineByChar",match:"__",terminator:"__",element:"u",handler:Wikifier.formatHelpers.charFormatHelper},{name:"italicByChar",match:"//",terminator:"//",element:"em",handler:Wikifier.formatHelpers.charFormatHelper},{name:"subscriptByChar",match:"~~",terminator:"~~",element:"sub",handler:Wikifier.formatHelpers.charFormatHelper},{name:"superscriptByChar",match:"\\^\\^",terminator:"\\^\\^",element:"sup",handler:Wikifier.formatHelpers.charFormatHelper},{name:"monospacedByChar",match:"\\{\\{\\{",lookahead:"\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",handler:function(a){"use strict";var b=new RegExp(this.lookahead,"mg"),c,d;b.lastIndex=a.matchStart,c=b.exec(a.source),c&&c.index===a.matchStart&&(d=insertElement(a.output,"code",null,null,c[1]),a.nextMatch=c.index+c[0].length)}},{name:"styleByChar",match:"@@",terminator:"@@",lookahead:"(?:([^\\(@]+)\\(([^\\)]+)(?:\\):))|(?:([^:@]+):([^;]+);)",handler:function(a){"use strict";var b=insertElement(a.output,"span",null,null,null),c=Wikifier.formatHelpers.inlineCssHelper(a);if(c.length===0)b.className="marked";else for(var d=0;d<c.length;d++)b.style[c[d].style]=c[d].value;a.subWikify(b,this.terminator)}},{name:"lineBreak",match:"\\n",handler:function(a){"use strict",insertElement(a.output,"br")}}],Wikifier.textPrimitives={anyDigit:"[0-9]",anyNumberChar:"[0-9\\.E]",urlPattern:"(?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b)"},Wikifier.createInternalLink=function(a,b){"use strict";var c=insertElement(a,"a",b);return c.href="#_",tale.has(b)?c.className="internalLink":c.className="brokenLink",c.onclick=function(){return state.display(b,c),!1},a&&a.appendChild(c),c},Wikifier.createExternalLink=function(a,b){"use strict";var c=insertElement(a,"a");return c.href=b,c.className="externalLink",c.target="_blank",a&&a.appendChild(c),c},(new RegExp("[\u0150\u0170]","g")).test("\u0150")?(Wikifier.textPrimitives.upperLetter="[A-Z\u00c0-\u00de\u0150\u0170]",Wikifier.textPrimitives.lowerLetter="[a-z\u00df-\u00ff_0-9\\-\u0151\u0171]",Wikifier.textPrimitives.anyLetter="[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-\u0150\u0170\u0151\u0171]"):(Wikifier.textPrimitives.upperLetter="[A-Z\u00c0-\u00de]",Wikifier.textPrimitives.lowerLetter="[a-z\u00df-\u00ff_0-9\\-]",Wikifier.textPrimitives.anyLetter="[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-]"),History.prototype.init=function(){"use strict";var a=this;this.restore()||this.display("Start",null),this.hash=window.location.hash,this.interval=window.setInterval(function(){a.watchHash.apply(a)},250)},History.prototype.display=function(a,b,c){"use strict",console.log('displaying "'+a+'" '+(c||"")+" from ",b);var d=tale.get(a),e;this.history.unshift({passage:d,variables:clone(this.history[0].variables)}),this.history[0].hash=this.save(),e=d.render(),c!=="offscreen"&&(removeChildren($("passages")),$("passages").appendChild(e),c!=="quietly"&&fade(e,{fade:"in"}));if(c==="quietly"||c==="offscreen")e.style.visibility="visible";return c!=="offscreen"&&(document.title=tale.title,this.hash=this.save(),d.title!=="Start"&&(document.title+=": "+d.title,window.location.hash=this.hash),window.scroll(0,0)),e},History.prototype.restart=function(){"use strict",window.location.hash=""},History.prototype.save=function(a){"use strict";var b="";for(var c=this.history.length-1;c>=0;c--)this.history[c].passage&&this.history[c].passage.id&&(b+=this.history[c].passage.id.toString(36)+".");return"#"+b.substr(0,b.length-1)},History.prototype.restore=function(){"use strict";var a,b,c,d;try{if(window.location.hash===""||window.location.hash==="#")return!1;a=window.location.hash.replace("#","").split("."),b=[];for(var e=0;e<a.length;e++){c=parseInt(a[e],36);if(!tale.has(c))return!1;console.log("restoring id "+c),d=e===a.length-1?"":"offscreen",b.unshift(this.display(c,null,d))}return!0}catch(f){return console.log("restore failed",f),!1}},History.prototype.watchHash=function(){"use strict",window.location.hash!==this.hash&&(console.log("new hash: "+window.location.hash+", was "+this.hash),window.location.hash!==""&&window.location.hash!=="#"?(this.history=[{passage:null,variables:{}}],removeChildren($("passages")),$("passages").style.visibility="hidden",this.restore()||alert("The passage you had previously visited could not be found."),$("passages").style.visibility="visible"):window.location.reload(),this.hash=window.location.hash)},version.extensions.backMacro={major:1,minor:0,revision:0},macros.back={handler:function(a,b,c){"use strict";var d="",e;if(c[0]){for(var f=0;f<state.history.length;f++)if(state.history[f].passage.title===c[0]){d=state.history[f].hash;break}}else if(state.history[1])d=state.history[1].hash;else{throwError(a,"can't go back from the first passage read");return}if(d===""){throwError(a,"can't find passage \""+c[0]+'" in history');return}e=document.createElement("a"),e.className="back",e.href=d,e.innerHTML="<b>&laquo;</b> Back",a.appendChild(e)}},version.extensions.displayMacro={major:1,minor:0,revision:0},macros.display={handler:function(a,b,c){"use strict",console.log('<<display>>ing "'+c[0]+'"'),new Wikifier(a,tale.get(c[0]).text),console.log('<<display>> of "'+c[0]+'" complete')}},version.extensions.actionsMacro={major:1,minor:2,revision:0},macros.actions={handler:function(a,b,c){"use strict";var d=insertElement(a,"ul"),e,f,g;state.history[0].variables["actions clicked"]||(state.history[0].variables["actions clicked"]={}),g=function(){this.onclick=function(){state.history[0].variables["actions clicked"][this.id]=!0,state.display(this.id,this)}};for(var h=0;h<c.length;h++){if(state.history[0].variables["actions clicked"][c[h]])continue;e=insertElement(d,"li"),f=Wikifier.createInternalLink(e,c[h]),insertText(f,c[h]),g.call(f)}}},version.extensions.printMacro={major:1,minor:1,revision:0},macros.print={handler:function(place,macroName,params,parser){"use strict";var output;try{output=eval(parser.fullArgs()),output&&new Wikifier(place,output.toString())}catch(e){throwError(place,"bad expression: "+e.message)}}},version.extensions.setMacro={major:1,minor:1,revision:0},macros.set={handler:function(a,b,c,d){"use strict",macros.set.run(d.fullArgs())},run:function(expression){"use strict";try{return eval(Wikifier.parse(expression))}catch(e){console.log("bad expression: "+e.message)}}},version.extensions.ifMacros={major:1,minor:0,revision:0},macros["if"]={handler:function(place,macroName,params,parser){"use strict";var condition=parser.fullArgs(),srcOffset=parser.source.indexOf(">>",parser.matchStart)+2,src=parser.source.slice(srcOffset),endPos=-1,trueClause="",falseClause="";for(var i=0,nesting=1,currentClause=!0;i<src.length;i++){if(src.substr(i,9)==="<<endif>>"){nesting--;if(nesting===0){endPos=srcOffset+i+9;break}}src.substr(i,8)==="<<else>>"&&nesting===1&&(currentClause="false",i+=8),src.substr(i,5)==="<<if "&&nesting++,currentClause===!0?trueClause+=src.charAt(i):falseClause+=src.charAt(i)}try{eval(condition)?new Wikifier(place,trueClause.trim()):new Wikifier(place,falseClause.trim()),endPos!==-1?parser.nextMatch=endPos:throwError(place,"can't find matching endif")}catch(e){throwError(place,"bad condition: "+e.message)}}},macros["else"]=macros.endif={handler:function(){"use strict"}},version.extensions.rememberMacro={major:1,minor:1,revision:0},macros.remember={handler:function(place,macroName,params,parser){"use strict";var statement=parser.fullArgs(),expire=new Date,variable,value,variableSigil;macros.set.run(statement),variableSigil=Wikifier.parse("$"),variableSigil=variableSigil.replace("[","\\["),variableSigil=variableSigil.replace("]","\\]"),variable=statement.match(new RegExp(variableSigil+"(\\w+)","i"))[1],value=eval(Wikifier.parse("$"+variable));switch(typeof value){case"string":value='"'+value.replace(/"/g,'\\"')+'"';break;case"number":break;case"boolean":break;default:throwError(place,"can't remember $"+variable+" ("+typeof value+")");return}expire.setYear(expire.getFullYear()+1),document.cookie=macros.remember.prefix+variable+"="+value+"; expires="+expire.toGMTString()},init:function(){"use strict";var cookies,bits,statement;tale.has("StoryTitle")?macros.remember.prefix=tale.get("StoryTitle").text+"_":macros.remember.prefix="__jonah_",cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++)bits=cookies[i].split("="),bits[0].trim().indexOf(this.prefix)===0&&(statement=cookies[i].replace(this.prefix,"$"),eval(Wikifier.parse(statement)))}},version.extensions.SilentlyMacro={major:1,minor:0,revision:0},macros.silently={handler:function(a,b,c,d){"use strict";var e=insertElement(null,"div"),f=d.source.indexOf(">>",d.matchStart)+2,g=d.source.slice(f),h=-1,i="";for(var j=0;j<g.length;j++)g.substr(j,15)==="<<endsilently>>"?h=f+j+15:i+=g.charAt(j);h!==-1?(new Wikifier(e,i),d.nextMatch=h):throwError(a,"can't find matching endsilently")}},macros.endsilently={handler:function(){"use strict"}},version.extensions.choiceMacro={major:1,minor:0,revision:0},macros.choice={handler:function(a,b,c){"use strict",Wikifier.createInternalLink(a,c[0])}},Passage.prototype.render=function(){"use strict";var a=insertElement(null,"div","passage"+this.title,"passage"),b;return a.style.visibility="hidden",insertElement(a,"div","","header"),b=insertElement(a,"div","","content"),new Wikifier(b,this.text),insertElement(a,"div","","footer"),console.log(a),a},Passage.prototype.reset=function(){"use strict",console.log('resetting "'+this.title+'"'),this.text=this.initialText},Passage.prototype.excerpt=function(){"use strict";var a=this.text.replace(/<<.*?>>/g,""),b;return a=a.replace(/!.*?\n/g,""),a=a.replace(/[\[\]\/]/g,""),b=a.match(/(.*?\s.*?\s.*?\s.*?\s.*?\s.*?\s.*?)\s/),b[1]+"..."},Passage.unescapeLineBreaks=function(a){return"use strict",a&&a!==""?a.replace(/\\n/mg,"\n").replace(/\\/mg,"\\").replace(/\r/mg,""):""},Tale.prototype.has=function(a){"use strict";if(typeof a=="string")return this.passages[a]!==null&&typeof this.passages[a]!="undefined";for(var b in this.passages)if(this.passages[b].id===a)return!0;return!1},Tale.prototype.get=function(a){"use strict";if(typeof a=="string")return this.passages[a]||new Passage(a);for(var b in this.passages)if(this.passages[b].id===a)return this.passages[b]},Tale.prototype.lookup=function(a,b,c){"use strict";var d=[];for(var e in this.passages)if(this.passages.hasOwnProperty(e)){var f=this.passages[e];for(var g=0;g<f[a].length;g++)f[a][g]===b&&d.push(f)}return c||(c="title"),d.sort(function(a,b){return a[c]===b[c]?0:a[c]<b[c]?-1:1}),d},Tale.prototype.reset=function(){"use strict",console.log("resetting all passages");for(var a in this.passages)this.passages.hasOwnProperty(a)&&this.passages[a].reset()};var Interface={init:function(){"use strict",console.log("Interface.init()"),main(),$("snapback").onclick=Interface.showSnapback,$("restart").onclick=Interface.restart},restart:function(){"use strict",confirm("Are you sure you want to restart this story?")&&state.restart()},showSnapback:function(a){"use strict",Interface.hideAllMenus(),Interface.buildSnapback(),Interface.showMenu(a,$("snapbackMenu"))},buildSnapback:function(){"use strict";var a=!1,b,c=function(){this.onclick=function(){window.location.hash=this.hash}};removeChildren($("snapbackMenu"));for(var d=state.history.length-1;d>=0;d--)state.history[d].passage&&state.history[d].passage.tags.indexOf("bookmark")!==-1&&(b=document.createElement("div"),b.hash=state.history[d].hash,c().call(b),b.innerHTML=state.history[d].passage.excerpt(),$("snapbackMenu").appendChild(b),a=!0);a||(b=document.createElement("div"),b.innerHTML="<i>No passages available</i>",$("snapbackMenu").appendChild(b))},hideAllMenus:function(){"use strict",$("shareMenu").style.display="none",$("snapbackMenu").style.display="none"},showMenu:function(a,b){"use strict";var c;a||(a=window.event),c={x:0,y:0};if(a.pageX||a.pageY)c.x=a.pageX,c.y=a.pageY;else if(a.clientX||a.clientY)c.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;b.style.top=c.y+"px",b.style.left=c.x+"px",b.style.display="block",document.onclick=Interface.hideAllMenus,a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation()}};window.onload=Interface.init;
  })();</script>
</head>
<body>
  <ul id="sidebar">
    <li id="title">
      <span id="storyTitle"></span>
      <span id="titleSeparator"></span>
      <span id="storyAuthor"></span>
    </li>
    <li id="storyMenu"></li>
    <li id="snapback">Rewind</li>
    <li id="restart">Restart</li>
    <li id="credits">This story was created with <a href="http://gimcrackd.com/etc/src/">Twee</a> and is powered by <a href="http://tiddlywiki.com/">TiddlyWiki</a>.</li>
  </ul>
  <div id="snapbackMenu" class="menu"></div>
  <div id="passages"></div>
  <div id="storeArea">
